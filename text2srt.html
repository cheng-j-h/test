<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本转SRT字幕工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#10b981',
                        dark: '#1e293b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 标题区域 -->
        <header class="mb-8 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-dark text-shadow mb-2">
                <i class="fa fa-file-text-o text-primary mr-2"></i>文本转SRT字幕工具
            </h1>
            <p class="text-secondary">粘贴文本自动分割生成SRT字幕文件，支持自定义每句时长</p>
        </header>

        <!-- 主功能区域 -->
        <main class="bg-white rounded-xl shadow-md p-6 mb-6">
            <!-- 文本输入区域 -->
            <div class="mb-6">
                <label for="sourceText" class="block text-gray-700 font-medium mb-2">
                    <i class="fa fa-paste text-primary mr-1"></i>源文本（支持句号/。分割）
                </label>
                <textarea 
                    id="sourceText" 
                    class="w-full h-60 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all-300 resize-y"
                    placeholder="请粘贴需要转换的文本内容...&#10;示例：今天天气很好。我们去公园玩吧。晚上一起吃火锅。"></textarea>
            </div>

            <!-- 时长设置区域 -->
            <div class="mb-6 flex flex-col sm:flex-row gap-4 items-start sm:items-center">
                <label for="sentenceDuration" class="block text-gray-700 font-medium">
                    <i class="fa fa-clock-o text-primary mr-1"></i>每句时长（秒）
                </label>
                <div class="flex items-center gap-2 flex-1">
                    <input 
                        type="number" 
                        id="sentenceDuration" 
                        min="1" 
                        max="60" 
                        value="3"
                        class="w-20 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all-300"
                    >
                    <span class="text-gray-500">秒/句（建议1-10秒）</span>
                </div>
            </div>

            <!-- 操作按钮区域 -->
            <div class="mb-6 flex flex-wrap gap-3">
                <button 
                    id="convertBtn" 
                    class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 active:bg-primary/80 transition-all-300 flex items-center gap-2 shadow-sm"
                >
                    <i class="fa fa-magic"></i> 开始转换
                </button>
                <button 
                    id="clearBtn" 
                    class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 active:bg-gray-400 transition-all-300 flex items-center gap-2 shadow-sm"
                >
                    <i class="fa fa-trash"></i> 清空内容
                </button>
                <button 
                    id="downloadBtn" 
                    class="px-6 py-2 bg-accent text-white rounded-lg hover:bg-accent/90 active:bg-accent/80 transition-all-300 flex items-center gap-2 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled
                >
                    <i class="fa fa-download"></i> 下载SRT文件
                </button>
            </div>

            <!-- 输出预览区域 -->
            <div class="mt-8">
                <label for="srtOutput" class="block text-gray-700 font-medium mb-2">
                    <i class="fa fa-file-code-o text-primary mr-1"></i>SRT预览
                </label>
                <textarea 
                    id="srtOutput" 
                    class="w-full h-60 p-3 border border-gray-300 rounded-lg bg-gray-50 readonly:text-gray-800"
                    readonly
                    placeholder="转换后的SRT内容将显示在这里..."></textarea>
            </div>
        </main>

        <!-- 提示信息区域 -->
        <div class="bg-blue-50 border-l-4 border-primary p-4 rounded-lg text-sm text-blue-700 mb-8">
            <div class="flex items-start">
                <i class="fa fa-info-circle mt-0.5 mr-2 text-primary"></i>
                <div>
                    <p class="font-medium">使用说明</p>
                    <ul class="list-disc list-inside mt-1 space-y-1">
                        <li>文本会按中文句号（。）或英文句号（.）进行分割</li>
                        <li>空行和多余的空格会自动清理</li>
                        <li>字幕时间从00:00:00开始，每句时长可自定义</li>
                        <li>生成的SRT文件可直接用于视频播放器</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="text-center text-gray-500 text-sm">
            <p>© 2025 文本转SRT字幕工具 | 简单高效的字幕生成解决方案</p>
        </footer>
    </div>

    <script>
        // 获取DOM元素
        const sourceText = document.getElementById('sourceText');
        const sentenceDuration = document.getElementById('sentenceDuration');
        const convertBtn = document.getElementById('convertBtn');
        const clearBtn = document.getElementById('clearBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const srtOutput = document.getElementById('srtOutput');

        // 格式化秒数为SRT时间格式 (HH:MM:SS,mmm)
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const minutes = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
            const ms = Math.floor((seconds % 1) * 1000).toString().padStart(3, '0');
            return `${hours}:${minutes}:${secs},${ms}`;
        }

        // 分割文本并清理空内容
        function splitText(text) {
            // 替换中英文句号为统一分隔符，然后分割
            const separatorRegex = /[。.]/g;
            let sentences = text.replace(separatorRegex, '|')
                                .split('|')
                                .map(sentence => sentence.trim())
                                .filter(sentence => sentence.length > 0);
            
            return sentences;
        }

        // 生成SRT内容
        function generateSRT() {
            const text = sourceText.value.trim();
            if (!text) {
                alert('请输入需要转换的文本内容！');
                return;
            }

            // 获取每句时长，默认3秒
            let duration = parseInt(sentenceDuration.value) || 3;
            duration = Math.max(1, Math.min(60, duration)); // 限制1-60秒

            const sentences = splitText(text);
            if (sentences.length === 0) {
                alert('未识别到有效文本内容！');
                return;
            }

            let currentTime = 0;
            let srtContent = '';

            // 遍历生成每句字幕
            sentences.forEach((sentence, index) => {
                const sequence = index + 1;
                const startTime = formatTime(currentTime);
                const endTime = formatTime(currentTime + duration);
                
                // 拼接SRT格式
                srtContent += `${sequence}\n`;
                srtContent += `${startTime} --> ${endTime}\n`;
                srtContent += `${sentence}\n\n`;

                // 更新当前时间
                currentTime += duration;
            });

            // 显示SRT内容并启用下载按钮
            srtOutput.value = srtContent;
            downloadBtn.disabled = false;
        }

        // 下载SRT文件
        function downloadSRT() {
            const srtContent = srtOutput.value;
            if (!srtContent) return;

            // 创建Blob对象
            const blob = new Blob([srtContent], { type: 'text/plain; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            // 创建下载链接
            const a = document.createElement('a');
            a.href = url;
            a.download = `字幕_${new Date().getTime()}.srt`;
            document.body.appendChild(a);
            a.click();
            
            // 清理
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 清空所有内容
        function clearAll() {
            sourceText.value = '';
            srtOutput.value = '';
            sentenceDuration.value = 3;
            downloadBtn.disabled = true;
        }

        // 绑定事件
        convertBtn.addEventListener('click', generateSRT);
        clearBtn.addEventListener('click', clearAll);
        downloadBtn.addEventListener('click', downloadSRT);

        // 键盘快捷键：Ctrl/Cmd + Enter 转换
        sourceText.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                generateSRT();
            }
        });

        // 时长输入框只允许数字
        sentenceDuration.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/\D/g, '');
        });
    </script>
</body>
</html>
